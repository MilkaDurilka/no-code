import{a as A,j as m}from"./jsx-runtime-29545a09.js";import{r as n}from"./index-76fb7be0.js";import{E as B,G as k}from"./html-083cb0d0.js";import{S as P,K as W,C as M,H as q}from"./index-7e5d883d.js";import{A as z}from"./index-0bbeb583.js";import{s as E}from"./utils-0b1df067.js";import"./_commonjsHelpers-de833af9.js";import"./gapSize-536431cf.js";import"./isNativeReflectConstruct-4d4208e5.js";import"./index-f3b9022e.js";function x({xNodes:s=10,yNodes:r=10,isCustom:u=!1,isRandomLinked:d=!0}){const c=[],i=[];let o=1,a=null;for(let e=0;e<r;e++)for(let t=0;t<s;t++){const b={x:t*100,y:e*50},f={id:`stress-${o.toString()}`,shape:"custom-rect",label:"Системный",zIndex:10,...b,...{width:100,height:40}};if(c.push(f),a&&o<=s*r){const y=`${t}-${e}`,p=d?Math.ceil(Math.random()*a):a;i.push({id:y,source:`stress-${p.toString()}`,target:`stress-${o.toString()}`,shape:"edge",zIndex:0})}a=o,o++}return{nodes:c,edges:i,cells:[...c,...i]}}const $={grid:!0,mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:0,maxScale:7},connecting:{router:"orth",connector:{name:"rounded",args:{radius:8}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,snap:{radius:20},createEdge(){return new B({attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},zIndex:0})},validateConnection({targetMagnet:s}){return!!s}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}}},v=(s,r)=>{for(let u=0,d=s.length;u<d;u+=1)s[u].style.visibility=r?"visible":"hidden"},K={groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"bottom"}]};k.registerNode("custom-rect",{inherit:"rect",width:66,height:36,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF"},text:{fontSize:12,fill:"#262626"}},ports:{...K}},!0);k.registerNode("custom-polygon",{inherit:"polygon",width:66,height:36,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF"},text:{fontSize:12,fill:"#262626"}},ports:{...K,items:[{group:"top"},{group:"bottom"}]}},!0);const G=s=>{const[r,u]=n.useState(null),[d,c]=n.useState({});n.useEffect(()=>{const e=new k({container:s.current,...$});i(e),o(e),a(e),u(e)},[]);const i=e=>{e.use(new P).use(new W).use(new M).use(new q)},o=e=>{e.bindKey(["meta+c","ctrl+c"],()=>{const t=e.getSelectedCells();return t.length&&e.copy(t),!1}),e.bindKey(["meta+x","ctrl+x"],()=>{const t=e.getSelectedCells();return t.length&&e.cut(t),!1}),e.bindKey(["meta+v","ctrl+v"],()=>{if(!e.isClipboardEmpty()){const t=e.paste({offset:32});e.cleanSelection(),e.select(t)}return!1}),e.bindKey(["meta+z","ctrl+z"],()=>(e.canUndo()&&e.undo(),!1)),e.bindKey(["meta+shift+z","ctrl+shift+z"],()=>(e.canRedo()&&e.redo(),!1)),e.bindKey(["meta+a","ctrl+a"],()=>{const t=e.getNodes();t&&e.select(t)}),e.bindKey("backspace",()=>{const t=e.getSelectedCells();t.length&&e.removeCells(t)}),e.bindKey(["ctrl+1","meta+1"],()=>{e.zoom()<1.5&&e.zoom(.1)}),e.bindKey(["ctrl+2","meta+2"],()=>{e.zoom()>.5&&e.zoom(-.1)})},a=e=>{e.on("node:mouseenter",()=>{const t=s.current.querySelectorAll(".x6-port-body");v(t,!0)}),e.on("node:mouseleave",()=>{const t=s.current.querySelectorAll(".x6-port-body");v(t,!1)})};return{graph:r,customNodes:d}};const O=({xNodes:s,yNodes:r,isCustom:u})=>{const d=n.useRef(null),c=n.useRef(null),i=n.useRef([]),[o,a]=n.useState(!1),{graph:e,customNodes:t}=G(d);n.useEffect(()=>{if(!e)return;const{cells:f}=x({xNodes:s,yNodes:r});e.fromJSON(f)},[e,s,r]);const b=n.useCallback(()=>{if(!e)return;i.current.forEach(l=>{cancelIdleCallback(l)}),i.current=[];const{nodes:f,edges:y}=x({xNodes:s,yNodes:r}),p=[];f.forEach(l=>{const h={...l,x:Math.random()*1500,y:Math.random()*1500,zIndex:100};p.push(h)}),e.clearCells(),E(p).forEach(l=>{const h=requestIdleCallback(()=>{e.addNodes(l)},{timeout:1e3});i.current.push(h)});const C=[];y.forEach(l=>{C.push(e.createEdge({source:l.source,target:l.target}).setZIndex(10))}),E(C).forEach(l=>{const h=requestIdleCallback(()=>{e.addEdges(l)},{timeout:1e3});i.current.push(h)})},[e]);n.useEffect(()=>{o&&!c.current&&(c.current=setInterval(()=>{b()},1e3)),!o&&c.current&&(clearInterval(c.current),c.current=null)},[o]);const S=n.useCallback(()=>{a(!0)},[]),F=n.useCallback(()=>{a(!1)},[]);return A("div",{children:[m(z,{}),o&&m(z,{}),m("button",{onClick:S,children:"start"}),m("button",{onClick:F,children:"stop"}),m("button",{onClick:b,children:"change pos"}),m("div",{className:"container",style:{height:"100vh"},children:m("div",{ref:d,className:"graph-container",style:{height:"100vh"}})})]})},X={title:"Antv/Stress",component:O,tags:["autodocs"]},g={args:{xNodes:30,yNodes:30,isCustom:!1}};var I,w,N;g.parameters={...g.parameters,docs:{...(I=g.parameters)==null?void 0:I.docs,source:{originalSource:`{
  args: {
    xNodes: 30,
    yNodes: 30,
    isCustom: false
  }
}`,...(N=(w=g.parameters)==null?void 0:w.docs)==null?void 0:N.source}}};const Y=["Primary"];export{g as Primary,Y as __namedExportsOrder,X as default};
