import{a as y,j as r}from"./jsx-runtime-29545a09.js";import{r as m}from"./index-76fb7be0.js";import{P as O,E as M,u as R,G as x,m as E,n as G}from"./html-7ecd7282.js";import{S as _}from"./index-9bef578c.js";import{T as D,D as F,r as j}from"./view-a4012fb1.js";import{c as B}from"./gapSize-176db3ef.js";import{A as v}from"./index-d0d2ffef.js";import{s as T}from"./utils-0b1df067.js";import"./_commonjsHelpers-de833af9.js";import"./isNativeReflectConstruct-4d4208e5.js";import"./toConsumableArray-3cd4081e.js";import"./index-f3b9022e.js";import"./asyncToGenerator-e43f4a97.js";import"./client-e9cc230c.js";const U=(e,t,s)=>{const a=[],o=[],d=[{id:"node-0",shape:"data-processing-dag-node",x:-250,y:0,ports:[{id:"node-0-out",group:"out"}],data:{name:"ввод данных_0",type:"INPUT",checkStatus:"success"}}],i=[];for(let c=0;c<e;c++){let l=null;for(let n=0;n<t;n++){const u={id:`node-${n}-${c}`,shape:"data-processing-dag-node",x:s?Math.random()*5e3:250*n,y:s?Math.random()*5e3:100*c,ports:[{id:`node-${n}-${c}-in`,group:"in"},{id:`node-${n}-${c}-out`,group:"out"}],data:{name:`Фильтрация данных_${n}-${c}`,type:"FILTER"}};if(d.push(u),a.push({id:u.id,status:"success"}),l){const A={id:`edge-${n}-${c}`,source:{cell:l.id,port:l.ports[0]},target:{cell:u.id,port:u.ports[1]},shape:"edge",zIndex:-1,data:{source:l.id,target:u.id}};i.push(A),o.push({id:A.id,status:"success"})}l=u}l=null}return{nodes:d,edges:i,nodeStatusList:a,edgeStatusList:o}};var P=(e=>(e.INPUT="INPUT",e.FILTER="FILTER",e.JOIN="JOIN",e.UNION="UNION",e.AGG="AGG",e.OUTPUT="OUTPUT",e))(P||{}),I=(e=>(e.DEFAULT="default",e.SUCCESS="success",e.ERROR="error",e))(I||{});const z={panning:{enabled:!0,eventTypes:["leftMouseDown","mouseWheel"]},mousewheel:{enabled:!0,modifiers:"ctrl",maxScale:7,minScale:0},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#fff",stroke:"#31d0c6",strokeWidth:4}}}},connecting:{snap:!0,allowBlank:!1,allowLoop:!1,highlight:!0,sourceAnchor:{name:"left",args:{dx:O.IS_SAFARI?4:8}},targetAnchor:{name:"right",args:{dx:O.IS_SAFARI?4:-8}},createEdge(){return new M({shape:"edge",attrs:{line:{strokeDasharray:"5 5"}},zIndex:-1})},validateConnection({sourceMagnet:e,targetMagnet:t}){return!(!e||e.getAttribute("port-group")==="in"||!t||t.getAttribute("port-group")!=="in")}}},S=[{type:"FILTER",name:"Фильтрация данных"},{type:"JOIN",name:"Подключения к данным"},{type:"UNION",name:"Объединение данных"},{type:"AGG",name:"Агрегация данных"},{type:"OUTPUT",name:"вывод данных"}],C={INPUT:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*RXnuTpQ22xkAAAAAAAAAAAAADtOHAQ/original",FILTER:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*ZJ6qToit8P4AAAAAAAAAAAAADtOHAQ/original",JOIN:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*EHqyQoDeBvIAAAAAAAAAAAAADtOHAQ/original",UNION:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*k4eyRaXv8gsAAAAAAAAAAAAADtOHAQ/original",AGG:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*TKG8R6nfYiAAAAAAAAAAAAAADtOHAQ/original",OUTPUT:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*zUgORbGg1HIAAAAAAAAAAAAADtOHAQ/original"},H=(e,t,s=250,a=100)=>{const o=[];t.getEdges().forEach(l=>{var u;console.log("graph.getEdges()",t.getEdges());const n=(u=l.toJSON())==null?void 0:u.data;console.log("originEdge",n),n.source===e.id&&o.push(n.target)});const d=e.getPosition();let i=1/0,c=-1/0;return t.getNodes().forEach(l=>{if(o.indexOf(l.id)>-1){const n=l.getPosition();n.x<i&&(i=n.x),n.y>c&&(c=n.y)}}),{x:i!==1/0?i:d.x+s,y:c!==-1/0?c+a:d.y}},Q=(e,t)=>{let s=[];switch(e){case"INPUT":s=[{id:`${t}-out`,group:"out"}];break;case"OUTPUT":s=[{id:`${t}-in`,group:"in"}];break;default:s=[{id:`${t}-in`,group:"in"},{id:`${t}-out`,group:"out"}];break}return s},W=(e,t,s)=>{var l;if(!t)return{};let a={};const o=t.getNodes().filter(n=>{var u;return((u=n.getData())==null?void 0:u.type)===e}),d=(l=S==null?void 0:S.find(n=>n.type===e))==null?void 0:l.name,i=R(),c={id:i,shape:"data-processing-dag-node",x:s==null?void 0:s.x,y:s==null?void 0:s.y,ports:Q(e,i),data:{name:`${d}_${o.length+1}`,type:e}};return a=t.addNode(c),a},J=(e,t,s)=>{const a={id:R(),shape:"data-processing-curve",source:{cell:e,port:`${e}-out`},target:{cell:t,port:`${t}-in`},zIndex:-1,data:{source:e,target:t}};s&&s.addEdge(a)},q={padding:{left:10,right:10}},X=(e,t)=>{t.forEach(s=>{const{id:a,status:o,statusMsg:d}=s,i=e.getCellById(a),c=i.getData();i.setData({...c,status:o,statusMsg:d})})},Y=e=>{e.getEdges().forEach(t=>{t.attr({line:{stroke:"#3471F9"}}),t.attr("line/strokeDasharray",5),t.attr("line/style/animation","running-line 30s infinite linear")})},K=(e,t)=>{e.getEdges().forEach(s=>{s.attr("line/strokeDasharray",0),s.attr("line/style/animation","")}),t.forEach(s=>{const{id:a,status:o}=s,d=e.getCellById(a);o==="success"&&d.attr("line/stroke","#52c41a"),o==="error"&&d.attr("line/stroke","#ff4d4f")})},Z=(e,t)=>{const{graph:s}=e.model||{};if(s){const a=H(e,s),o=W(t,s,a),d=e.id,i=o.id;J(d,i,s)}},V=e=>{var h;const[t,s]=m.useState(!1),a=()=>r("ul",{children:S.map(g=>{const f=y("a",{onClick:()=>o(g.type),children:[r("i",{className:"node-mini-logo",style:{backgroundImage:`url(${C[g.type]})`}}),r("span",{children:g.name})]});return r("li",{className:"each-sub-menu",children:f},g.type)})}),o=g=>{Z(e.node,g),s(!1)},d=g=>{s(g)},i=()=>{const{node:g}=e;(g.getPorts()||[]).forEach(p=>{g.setPortProp(p.id,"attrs/circle",{fill:"#fff",stroke:"#85A5FF"})})},c=()=>{const{node:g}=e;(g.getPorts()||[]).forEach(p=>{g.setPortProp(p.id,"attrs/circle",{fill:"transparent",stroke:"transparent"})})},l=(h=e.node)==null?void 0:h.getData(),{name:n,type:u,status:A,statusMsg:k}=l;return y("div",{className:"data-processing-dag-node",children:[y("div",{className:"main-area",onMouseEnter:i,onMouseLeave:c,children:[y("div",{className:"main-info",children:[r("i",{className:"node-logo",style:{backgroundImage:`url(${C[u]})`}}),r(D,{title:n,mouseEnterDelay:.8,children:r("div",{className:"ellipsis-row node-name",children:n})})]}),y("div",{className:"status-action",children:[A===I.ERROR&&r(D,{title:k,children:r("i",{className:"status-icon status-icon-error"})}),A===I.SUCCESS&&r("i",{className:"status-icon status-icon-success"}),r("div",{className:"more-action-container",children:r("i",{className:"more-action"})})]})]}),u!==P.OUTPUT&&r("div",{className:"plus-dag",children:r(F,{dropdownRender:a,overlayClassName:"processing-node-menu",trigger:["click"],placement:"bottom",open:t,onOpenChange:d,children:r("i",{className:B("plus-action",{"plus-action-selected":t})})})})]})};j({shape:"data-processing-dag-node",width:212,height:48,component:V,ports:{groups:{in:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}},out:{position:{name:"right",args:{dx:-32}},attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}}}}});x.registerConnector("curveConnector",(e,t)=>{const s=Math.abs(t.x-e.x),a=new E;return a.appendSegment(E.createSegment("M",e.x-4,e.y)),a.appendSegment(E.createSegment("L",e.x+12,e.y)),a.appendSegment(E.createSegment("C",e.x<t.x?e.x+s/2:e.x-s/2,e.y,e.x<t.x?t.x-s/2:t.x+s/2,t.y,t.x-6,t.y)),a.appendSegment(E.createSegment("L",t.x+2,t.y)),a.serialize()},!0);G.config({markup:[{tagName:"path",selector:"wrap",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",attrs:{fill:"none",pointerEvents:"none"}}],connector:{name:"curveConnector"},attrs:{wrap:{connection:!0,strokeWidth:10,strokeLinejoin:"round"},line:{connection:!0,stroke:"#A2B1C3",strokeWidth:1,targetMarker:{name:"classic",size:6}}}});x.registerEdge("data-processing-curve",G,!0);const ee=e=>{const[t,s]=m.useState(null);return m.useEffect(()=>{const a=new x({container:e.current,...z});s(a),a.use(new _({multiple:!0,rubberEdge:!0,rubberNode:!0,modifiers:"shift",rubberband:!0}))},[]),{graph:t}};const te=()=>{const e=m.useRef(null),{graph:t}=ee(e),[s,a]=m.useState({edgeStatusList:[],nodeStatusList:[]}),o=m.useRef(null),d=m.useRef([]),[i,c]=m.useState(!1);m.useEffect(()=>{if(!t)return;const{nodes:k,edges:h,nodeStatusList:g,edgeStatusList:f}=U(33,30);a({nodeStatusList:g,edgeStatusList:f}),t.fromJSON({nodes:k,edges:h}),t.zoomToFit(q)},[t]);const l=m.useCallback(()=>{!s.edgeStatusList||!s.nodeStatusList||(Y(t),setTimeout(()=>{X(t,s.nodeStatusList),K(t,s.edgeStatusList)},1e4))},[t,s]),n=()=>{t.clearCells(),d.current.forEach(p=>{cancelIdleCallback(p)}),d.current=[];const{nodes:k,edges:h}=U(33,30,!0);T(k).forEach(p=>{const b=requestIdleCallback(()=>{t.addNodes(p)},{timeout:500});d.current.push(b)}),T(h).forEach(p=>{const b=requestIdleCallback(()=>{t.addEdges(p)},{timeout:500});d.current.push(b)})};m.useEffect(()=>{i&&!o.current&&(o.current=setInterval(()=>{n()},2e3)),!i&&o.current&&(clearInterval(o.current),o.current=null)},[i]);const u=m.useCallback(()=>{c(!0)},[]),A=m.useCallback(()=>{c(!1)},[]);return y("div",{children:[r(v,{}),i&&r(v,{}),r("button",{onClick:u,children:"start"}),r("button",{onClick:A,children:"stop"}),r("button",{onClick:n,children:"change pos"}),r("button",{onClick:l,children:"animate"}),r("div",{className:"container",children:r("div",{ref:e,className:"graph-container"})})]})},he={title:"AntvX6/DagStress",component:te,tags:["autodocs"]},N={args:{}};var L,w,$;N.parameters={...N.parameters,docs:{...(L=N.parameters)==null?void 0:L.docs,source:{originalSource:`{
  args: {}
}`,...($=(w=N.parameters)==null?void 0:w.docs)==null?void 0:$.source}}};const fe=["Primary"];export{N as Primary,fe as __namedExportsOrder,he as default};
