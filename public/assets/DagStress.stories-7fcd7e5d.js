import{a as y,j as r}from"./jsx-runtime-29545a09.js";import{r as p}from"./index-76fb7be0.js";import{P as O,E as B,u as R,G as x,m as N,n as G}from"./html-7ecd7282.js";import{S as z}from"./index-9bef578c.js";import{T as v,D as H,r as Q}from"./index-e9872536.js";import{c as W}from"./gapSize-0f168ba5.js";import{A as D}from"./index-5a5beda9.js";import{s as T}from"./utils-0b1df067.js";import"./_commonjsHelpers-de833af9.js";import"./index-f3b9022e.js";import"./client-e9cc230c.js";import"./isNativeReflectConstruct-4d4208e5.js";const U=(e,t,s)=>{const n=[],c=[],d=[{id:"node-0",shape:"data-processing-dag-node",x:-250,y:0,ports:[{id:"node-0-out",group:"out"}],data:{name:"ввод данных_0",type:"INPUT",checkStatus:"success"}}],i=[];for(let o=0;o<e;o++){let u=null;for(let a=0;a<t;a++){const g={id:`node-${a}-${o}`,shape:"data-processing-dag-node",x:s?Math.random()*5e3:250*a,y:s?Math.random()*5e3:100*o,ports:[{id:`node-${a}-${o}-in`,group:"in"},{id:`node-${a}-${o}-out`,group:"out"}],data:{name:`Фильтрация данных_${a}-${o}`,type:"FILTER"}};if(d.push(g),n.push({id:g.id,status:"success"}),u){const A={id:`edge-${a}-${o}`,source:{cell:g.id,port:g.ports[1]},target:{cell:u.id,port:u.ports[0]},shape:"data-processing-curve",zIndex:-1,data:{source:g.id,target:u.id}};i.push(A),c.push({id:A.id,status:"success"})}u=g}u=null}return{nodes:d,edges:i,nodeStatusList:n,edgeStatusList:c}};var P=(e=>(e.INPUT="INPUT",e.FILTER="FILTER",e.JOIN="JOIN",e.UNION="UNION",e.AGG="AGG",e.OUTPUT="OUTPUT",e))(P||{}),I=(e=>(e.DEFAULT="default",e.SUCCESS="success",e.ERROR="error",e))(I||{});const J={panning:{enabled:!0,eventTypes:["leftMouseDown","mouseWheel"]},mousewheel:{enabled:!0,modifiers:"ctrl",maxScale:7,minScale:0},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#fff",stroke:"#31d0c6",strokeWidth:4}}}},connecting:{snap:!0,allowBlank:!1,allowLoop:!1,highlight:!0,sourceAnchor:{name:"left",args:{dx:O.IS_SAFARI?4:8}},targetAnchor:{name:"right",args:{dx:O.IS_SAFARI?4:-8}},createEdge(){return new B({shape:"data-processing-curve",attrs:{line:{strokeDasharray:"5 5"}},zIndex:-1})},validateConnection({sourceMagnet:e,targetMagnet:t}){return!(!e||e.getAttribute("port-group")==="in"||!t||t.getAttribute("port-group")!=="in")}}},b=[{type:"FILTER",name:"Фильтрация данных"},{type:"JOIN",name:"Подключения к данным"},{type:"UNION",name:"Объединение данных"},{type:"AGG",name:"Агрегация данных"},{type:"OUTPUT",name:"вывод данных"}],C={INPUT:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*RXnuTpQ22xkAAAAAAAAAAAAADtOHAQ/original",FILTER:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*ZJ6qToit8P4AAAAAAAAAAAAADtOHAQ/original",JOIN:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*EHqyQoDeBvIAAAAAAAAAAAAADtOHAQ/original",UNION:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*k4eyRaXv8gsAAAAAAAAAAAAADtOHAQ/original",AGG:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*TKG8R6nfYiAAAAAAAAAAAAAADtOHAQ/original",OUTPUT:"https://mdn.alipayobjects.com/huamei_f4t1bn/afts/img/A*zUgORbGg1HIAAAAAAAAAAAAADtOHAQ/original"},q=(e,t,s=250,n=100)=>{const c=[];t.getEdges().forEach(u=>{var g;console.log("graph.getEdges()",t.getEdges());const a=(g=u.toJSON())==null?void 0:g.data;console.log("originEdge",a),a.source===e.id&&c.push(a.target)});const d=e.getPosition();let i=1/0,o=-1/0;return t.getNodes().forEach(u=>{if(c.indexOf(u.id)>-1){const a=u.getPosition();a.x<i&&(i=a.x),a.y>o&&(o=a.y)}}),{x:i!==1/0?i:d.x+s,y:o!==-1/0?o+n:d.y}},X=(e,t)=>{let s=[];switch(e){case"INPUT":s=[{id:`${t}-out`,group:"out"}];break;case"OUTPUT":s=[{id:`${t}-in`,group:"in"}];break;default:s=[{id:`${t}-in`,group:"in"},{id:`${t}-out`,group:"out"}];break}return s},Y=(e,t,s)=>{var u;if(!t)return{};let n={};const c=t.getNodes().filter(a=>{var g;return((g=a.getData())==null?void 0:g.type)===e}),d=(u=b==null?void 0:b.find(a=>a.type===e))==null?void 0:u.name,i=R(),o={id:i,shape:"data-processing-dag-node",x:s==null?void 0:s.x,y:s==null?void 0:s.y,ports:X(e,i),data:{name:`${d}_${c.length+1}`,type:e}};return n=t.addNode(o),n},K=(e,t,s)=>{const n={id:R(),shape:"data-processing-curve",source:{cell:e,port:`${e}-out`},target:{cell:t,port:`${t}-in`},zIndex:-1,data:{source:e,target:t}};s&&s.addEdge(n)},Z={padding:{left:10,right:10}},V=(e,t)=>{t.forEach(s=>{const{id:n,status:c,statusMsg:d}=s,i=e.getCellById(n),o=i.getData();i.setData({...o,status:c,statusMsg:d})})},ee=e=>{e.getEdges().forEach(t=>{t.attr({line:{stroke:"#3471F9"}}),t.attr("line/strokeDasharray",5),t.attr("line/style/animation","running-line 30s infinite linear")})},te=(e,t)=>{e.getEdges().forEach(s=>{s.attr("line/strokeDasharray",0),s.attr("line/style/animation","")}),t.forEach(s=>{const{id:n,status:c}=s,d=e.getCellById(n);c==="success"&&d.attr("line/stroke","#52c41a"),c==="error"&&d.attr("line/stroke","#ff4d4f")})},se=e=>{var E;const[t,s]=p.useState(!1),n=l=>{const{node:m}=e,{graph:h}=m.model||{};if(h){const M=q(m,h),_=Y(l,h,M),F=m.id,j=_.id;K(F,j,h)}},c=()=>r("ul",{children:b.map(l=>{const m=y("a",{onClick:()=>d(l.type),children:[r("i",{className:"node-mini-logo",style:{backgroundImage:`url(${C[l.type]})`}}),r("span",{children:l.name})]});return r("li",{className:"each-sub-menu",children:m},l.type)})}),d=l=>{n(l),s(!1)},i=l=>{s(l)},o=()=>{const{node:l}=e;(l.getPorts()||[]).forEach(h=>{l.setPortProp(h.id,"attrs/circle",{fill:"#fff",stroke:"#85A5FF"})})},u=()=>{const{node:l}=e;(l.getPorts()||[]).forEach(h=>{l.setPortProp(h.id,"attrs/circle",{fill:"transparent",stroke:"transparent"})})},a=(E=e.node)==null?void 0:E.getData(),{name:g,type:A,status:f,statusMsg:k}=a;return y("div",{className:"data-processing-dag-node",children:[y("div",{className:"main-area",onMouseEnter:o,onMouseLeave:u,children:[y("div",{className:"main-info",children:[r("i",{className:"node-logo",style:{backgroundImage:`url(${C[A]})`}}),r(v,{title:g,mouseEnterDelay:.8,children:r("div",{className:"ellipsis-row node-name",children:g})})]}),y("div",{className:"status-action",children:[f===I.ERROR&&r(v,{title:k,children:r("i",{className:"status-icon status-icon-error"})}),f===I.SUCCESS&&r("i",{className:"status-icon status-icon-success"}),r("div",{className:"more-action-container",children:r("i",{className:"more-action"})})]})]}),A!==P.OUTPUT&&r("div",{className:"plus-dag",children:r(H,{dropdownRender:c,overlayClassName:"processing-node-menu",trigger:["click"],placement:"bottom",open:t,onOpenChange:i,children:r("i",{className:W("plus-action",{"plus-action-selected":t})})})})]})};Q({shape:"data-processing-dag-node",width:212,height:48,component:se,ports:{groups:{in:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}},out:{position:{name:"right",args:{dx:-32}},attrs:{circle:{r:4,magnet:!0,stroke:"transparent",strokeWidth:1,fill:"transparent"}}}}}});x.registerConnector("curveConnector",(e,t)=>{const s=Math.abs(t.x-e.x),n=new N;return n.appendSegment(N.createSegment("M",e.x-4,e.y)),n.appendSegment(N.createSegment("L",e.x+12,e.y)),n.appendSegment(N.createSegment("C",e.x<t.x?e.x+s/2:e.x-s/2,e.y,e.x<t.x?t.x-s/2:t.x+s/2,t.y,t.x-6,t.y)),n.appendSegment(N.createSegment("L",t.x+2,t.y)),n.serialize()},!0);G.config({markup:[{tagName:"path",selector:"wrap",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",attrs:{fill:"none",pointerEvents:"none"}}],connector:{name:"curveConnector"},attrs:{wrap:{connection:!0,strokeWidth:10,strokeLinejoin:"round"},line:{connection:!0,stroke:"#A2B1C3",strokeWidth:1,targetMarker:{name:"classic",size:6}}}});x.registerEdge("data-processing-curve",G,!0);const ne=e=>{const[t,s]=p.useState(null);return p.useEffect(()=>{const n=new x({container:e.current,...J});s(n),n.use(new z({multiple:!0,rubberEdge:!0,rubberNode:!0,modifiers:"shift",rubberband:!0}))},[]),{graph:t}};const ae=()=>{const e=p.useRef(null),{graph:t}=ne(e),[s,n]=p.useState({edgeStatusList:[],nodeStatusList:[]}),c=p.useRef(null),d=p.useRef([]),[i,o]=p.useState(!1);p.useEffect(()=>{if(!t)return;const{nodes:f,edges:k,nodeStatusList:E,edgeStatusList:l}=U(33,30);n({nodeStatusList:E,edgeStatusList:l}),t.fromJSON({nodes:f,edges:k}),t.zoomToFit(Z)},[t]);const u=p.useCallback(()=>{!s.edgeStatusList||!s.nodeStatusList||(ee(t),setTimeout(()=>{V(t,s.nodeStatusList),te(t,s.edgeStatusList)},1e4))},[t,s]),a=()=>{d.current.forEach(m=>{cancelIdleCallback(m)}),d.current=[];const{nodes:f,edges:k}=U(33,30,!0);t.clearCells(),T(f).forEach(m=>{const h=requestIdleCallback(()=>{t.addNodes(m)},{timeout:500});d.current.push(h)}),T(k).forEach(m=>{const h=requestIdleCallback(()=>{t.addEdges(m)},{timeout:500});d.current.push(h)})};p.useEffect(()=>{i&&!c.current&&(c.current=setInterval(()=>{a()},2e3)),!i&&c.current&&(clearInterval(c.current),c.current=null)},[i]);const g=p.useCallback(()=>{o(!0)},[]),A=p.useCallback(()=>{o(!1)},[]);return y("div",{children:[r(D,{}),i&&r(D,{}),r("button",{onClick:g,children:"start"}),r("button",{onClick:A,children:"stop"}),r("button",{onClick:a,children:"change pos"}),r("button",{onClick:u,children:"animate"}),r("div",{className:"container",style:{height:"100vh"},children:r("div",{ref:e,className:"graph-container",style:{height:"100vh"}})})]})},fe={title:"Antv/DagStress",component:ae,tags:["autodocs"]},S={args:{}};var L,w,$;S.parameters={...S.parameters,docs:{...(L=S.parameters)==null?void 0:L.docs,source:{originalSource:`{
  args: {}
}`,...($=(w=S.parameters)==null?void 0:w.docs)==null?void 0:$.source}}};const ye=["Primary"];export{S as Primary,ye as __namedExportsOrder,fe as default};
